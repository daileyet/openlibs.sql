<!DOCTYPE html>
<html lang="en-us">

	<head>
		<meta charset="UTF-8">
		<title>Openlibs.sql by daileyet</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
		<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
		<link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
	</head>

	<body>
		<section class="page-header">
			<h1 class="project-name">Openlibs.sql</h1>
			<h2 class="project-tagline">The lib of java database ORM simple implementation</h2>
			<a href="https://github.com/daileyet/openlibs.sql" class="btn">View on GitHub</a>
			<a href="https://github.com/daileyet/openlibs.sql/zipball/master" class="btn">Download .zip</a>
			<a href="https://github.com/daileyet/openlibs.sql/tarball/master" class="btn">Download .tar.gz</a>
		</section>

		<section class="main-content">
			<h1>
<a id="openlibssql" class="anchor" href="#openlibssql" aria-hidden="true"><span class="octicon octicon-link"></span></a>openlibs.sql</h1>

			<p>The lib of java database ORM simple implementation</p>

			<hr>
			<div class="toc">
				<ul>
					<li><a href="#session基本用法">Session基本用法</a></li>
					<li><a href="#配置文件和类使用">配置文件和类使用</a>
						<ul>
							<li><a href="#数据库属性文件">数据库属性文件</a></li>
							<li><a href="#配置类用法">配置类用法</a></li>
						</ul>
					</li>
					<li><a href="#session高级用法">Session高级用法</a>
						<ul>
							<li><a href="#实体类定义">实体类定义</a></li>
							<li><a href="#增删改">增删改</a></li>
							<li><a href="#条件查询">条件查询</a>
								<ul>
									<li><a href="#直接sql语句查询">直接SQL语句查询</a></li>
									<li><a href="#简单条件类查询">简单条件类查询</a></li>
									<li><a href="#智能queryfilter查询">智能QueryFilter查询</a></li>
								</ul>
							</li>
							<li><a href="#简单事务">简单事务</a></li>
							<li><a href="#连接池">连接池</a></li>
						</ul>
					</li>
					<li><a href="#JavaDoc">Java Doc</a></li>
				</ul>
			</div>
			<h4>
<a id="session基本用法" class="anchor" href="#session%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Session基本用法</strong>
</h4>

			<div class="highlight highlight-java"><pre><span class="pl-c">// get session instance by its factory</span>
<span class="pl-smi">Session</span> session <span class="pl-k">=</span> <span class="pl-smi">SessionFactory</span><span class="pl-k">.</span>getSession();</pre></div>

			<div class="highlight highlight-java"><pre><span class="pl-c">// fetch a entity by its key</span>
<span class="pl-smi">Message</span> message <span class="pl-k">=</span> session<span class="pl-k">.</span>load(<span class="pl-smi">Message</span><span class="pl-k">.</span>class, <span class="pl-s"><span class="pl-pds">"</span>1000<span class="pl-pds">"</span></span>);
<span class="pl-c">//TODO</span>
session<span class="pl-k">.</span>close();<span class="pl-c">// close session</span></pre></div>

			<div class="highlight highlight-java"><pre><span class="pl-c">// save a entity to table</span>
<span class="pl-smi">Message</span> message <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Message</span>();
message<span class="pl-k">.</span>setLocale(<span class="pl-smi">Locale</span><span class="pl-c1"><span class="pl-k">.</span>CHINA</span><span class="pl-k">.</span>toString());
message<span class="pl-k">.</span>setContent(<span class="pl-s"><span class="pl-pds">"</span>HELLO<span class="pl-pds">"</span></span>);
message<span class="pl-k">.</span>setMessageId(<span class="pl-s"><span class="pl-pds">"</span>2000<span class="pl-pds">"</span></span>);
session<span class="pl-k">.</span>save(message);
session<span class="pl-k">.</span>close();</pre></div>

			<h4>
<a id="配置文件和类使用" class="anchor" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%92%8C%E7%B1%BB%E4%BD%BF%E7%94%A8" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>配置文件和类使用</strong>
</h4>

			<ul>
				<li>配置文件名称: dbconfig.properties</li>
				<li>配置文件类: <a href="doc/openthinks/libs/sql/lang/Configurator.html">Configurator</a></li>
				<li>配置文件工厂类: <a href="doc/openthinks/libs/sql/lang/ConfiguratorFactory.html">ConfiguratorFactory</a></li>
			</ul>

			<h5>
<a id="数据库属性文件" class="anchor" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B1%9E%E6%80%A7%E6%96%87%E4%BB%B6" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>数据库属性文件</strong>
</h5>

			<p>格式如下:</p>

			<pre><code>#driver name
DRIVER=com.mysql.jdbc.Driver
#database url
URL=jdbc:mysql://localhost:3306/opendb
#database user
USERNAME=root
#database pass
USERPWD=123456
#databse dailect : MYSQL,ORACLE,SQLSERVER
DIALECT=MYSQL
</code></pre>

			<h5>
<a id="配置类用法" class="anchor" href="#%E9%85%8D%E7%BD%AE%E7%B1%BB%E7%94%A8%E6%B3%95" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>配置类用法</strong>
</h5>

			<p>Configurator的属性一一对应配置文件dbconfig.properties里的键 所以可以新建一个配置类实例，替代配置文件:
			</p>

			<div class="highlight highlight-java"><pre><span class="pl-smi">Configurator</span> conf <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Configurator</span>();
conf<span class="pl-k">.</span>setDriver(<span class="pl-s"><span class="pl-pds">"</span>xxx<span class="pl-pds">"</span></span>);
conf<span class="pl-k">.</span>setUrl(<span class="pl-s"><span class="pl-pds">"</span>xxx<span class="pl-pds">"</span></span>);
conf<span class="pl-k">.</span>setUserName(<span class="pl-s"><span class="pl-pds">"</span>xxx<span class="pl-pds">"</span></span>);
conf<span class="pl-k">.</span>setUserPwd(<span class="pl-s"><span class="pl-pds">"</span>xxx<span class="pl-pds">"</span></span>);
<span class="pl-c">// option, default value is false</span>
conf<span class="pl-k">.</span>setUsePool(<span class="pl-c1">true</span>);
<span class="pl-c">// option, default value is Dialect.MYSQL</span>
conf<span class="pl-k">.</span>setDialect(<span class="pl-smi">Dialect</span><span class="pl-c1"><span class="pl-k">.</span>ORACLE</span>);</pre></div>

			<p>ConfiguratorFactory类负责创建Configurator的实例</p>

			<div class="highlight highlight-java"><pre><span class="pl-c">// 方法1: 获得默认的配置类实例,将从默认配置文件dbconfig.properties中读取配置并实例化</span>
<span class="pl-smi">Configurator</span> fileConf <span class="pl-k">=</span> <span class="pl-smi">ConfiguratorFactory</span><span class="pl-k">.</span>getDefaultInstance();
<span class="pl-c">// 方法2: 获得新的配置类实例,将复制已有的配置实例</span>
<span class="pl-smi">Configurator</span> codeConf <span class="pl-k">=</span> <span class="pl-smi">ConfiguratorFactory</span><span class="pl-k">.</span>getInstance(conf);
<span class="pl-c">// 方法3: 重新设置ConfiguratorFactory的默认配置实例,指向已有的配置类实例</span>
<span class="pl-smi">ConfiguratorFactory</span><span class="pl-k">.</span>setConfigurator(conf);
<span class="pl-smi">Configurator</span> overrideConf <span class="pl-k">=</span> <span class="pl-smi">ConfiguratorFactory</span><span class="pl-k">.</span>getDefaultInstance();
<span class="pl-c">// 方法4: 读取外部文件实例化配置,配置文件名称可以自由命名</span>
<span class="pl-smi">File</span> file <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">File</span>(<span class="pl-s"><span class="pl-pds">"</span>C:<span class="pl-cce">\p</span>ath<span class="pl-cce">\f</span>ilename.properties<span class="pl-pds">"</span></span>);
<span class="pl-smi">Configurator</span> externalConf <span class="pl-k">=</span> <span class="pl-smi">ConfiguratorFactory</span><span class="pl-k">.</span>getInstance(file);</pre></div>

			<h4>
<a id="session高级用法" class="anchor" href="#session%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Session高级用法</strong>
</h4>

			<h5>
<a id="实体类定义" class="anchor" href="#%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%AE%9A%E4%B9%89" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>实体类定义</strong>
</h5>

			<p>目前支持两种类型的实体类: 继承自<a href="doc/openthinks/libs/sql/entity/Entity.html">Entity</a>类,带有JPA注解的POJO类</p>

			<p>openthinks.libs.sql.entity.Entity实例简单对应数据库中的表的一条记录,因此要求该实体类定义时注意以下事项:</p>

			<ol>
				<li>该实体类中的字段或属性名需要与对应表列名一样</li>
				<li>该实体类中定义的第一个字段作为对应表的主键</li>
				<li>该实体类的名称需与表名相同(仅在调用Session的高级API)</li>
			</ol>

			<p>例子:</p>

			<pre><code>//table structure
create table message(
    message_id varchar(100),
    message_local varchar(100),
    message_content varchar(1000)
);
</code></pre>

			<div class="highlight highlight-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">Message</span> <span class="pl-k">extends</span> <span class="pl-e">Entity</span> {
    <span class="pl-k">private</span> <span class="pl-smi">String</span> message_id;
    <span class="pl-k">private</span> <span class="pl-smi">String</span> message_locale;
    <span class="pl-k">private</span> <span class="pl-smi">String</span> message_content;
    <span class="pl-k">public</span> <span class="pl-smi">String</span> <span class="pl-en">getContent</span>() {
        <span class="pl-k">return</span> message_content;
    }
    <span class="pl-k">public</span> <span class="pl-smi">String</span> <span class="pl-en">getLocale</span>() {
        <span class="pl-k">return</span> message_locale;
    }
    <span class="pl-k">public</span> <span class="pl-smi">String</span> <span class="pl-en">getId</span>() {
        <span class="pl-k">return</span> message_id;
    }
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">setId</span>(<span class="pl-smi">String</span> <span class="pl-v">messageId</span>) {
        <span class="pl-v">this</span><span class="pl-k">.</span>message_id <span class="pl-k">=</span> messageId;
    }
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">setLocale</span>(<span class="pl-smi">String</span> <span class="pl-v">locale</span>) {
        <span class="pl-v">this</span><span class="pl-k">.</span>message_locale <span class="pl-k">=</span> locale;
    }
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">setContent</span>(<span class="pl-smi">String</span> <span class="pl-v">content</span>) {
        <span class="pl-v">this</span><span class="pl-k">.</span>message_content <span class="pl-k">=</span> content;
    }
}</pre></div>

			<p>JPA注解的POJO类没有额外的限制</p>

			<div class="highlight highlight-java"><pre><span class="pl-k">import</span> <span class="pl-smi">javax.persistence.Column</span>;
<span class="pl-k">import</span> <span class="pl-smi">javax.persistence.Entity</span>;
<span class="pl-k">import</span> <span class="pl-smi">javax.persistence.Id</span>;
<span class="pl-k">import</span> <span class="pl-smi">javax.persistence.Table</span>;
@<span class="pl-smi">Entity</span>
@Table(name <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>message<span class="pl-pds">"</span></span>)
<span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MessageJPA</span> {
    <span class="pl-k">@Id</span>
    <span class="pl-k">@Column</span>(<span class="pl-c1">name</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>message_id<span class="pl-pds">"</span></span>)
    <span class="pl-k">private</span> <span class="pl-smi">String</span> messageId;
    <span class="pl-k">@Column</span>(<span class="pl-c1">name</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>message_locale<span class="pl-pds">"</span></span>)
    <span class="pl-k">private</span> <span class="pl-smi">String</span> locale;
    <span class="pl-k">@Column</span>(<span class="pl-c1">name</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>message_content<span class="pl-pds">"</span></span>)
    <span class="pl-k">private</span> <span class="pl-smi">String</span> content;
    <span class="pl-c">/*</span>
<span class="pl-c">    *getter/setter method</span>
<span class="pl-c">    */</span>
}</pre></div>

			<h5>
<a id="增删改" class="anchor" href="#%E5%A2%9E%E5%88%A0%E6%94%B9" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>增删改</strong>
</h5>

			<p>在Session的DAO API中分为两大类，一类是无需编写SQL(High level);另一类是需要自行构造SQL(Low level).</p>

			<div class="highlight highlight-java"><pre><span class="pl-c">//&lt;T&gt; void openthinks.libs.sql.dhibernate.Session.save(T object)</span>
<span class="pl-c">// High level</span>
<span class="pl-smi">Session</span> session <span class="pl-k">=</span> <span class="pl-smi">SessionFactory</span><span class="pl-k">.</span>getSession();
<span class="pl-smi">MessageJPA</span> messageJPA <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">MessageJPA</span>();
messageJPA<span class="pl-k">.</span>setLocale(<span class="pl-smi">Locale</span><span class="pl-c1"><span class="pl-k">.</span>US</span><span class="pl-k">.</span>toString());
messageJPA<span class="pl-k">.</span>setContent(<span class="pl-s"><span class="pl-pds">"</span>HELLO<span class="pl-pds">"</span></span>);
messageJPA<span class="pl-k">.</span>setMessageId(<span class="pl-s"><span class="pl-pds">"</span>2000<span class="pl-pds">"</span></span>);
session<span class="pl-k">.</span>save(messageJPA);
<span class="pl-smi">Message</span> messageEntity <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">Message</span>();
messageEntity<span class="pl-k">.</span>setLocale(<span class="pl-smi">Locale</span><span class="pl-c1"><span class="pl-k">.</span>CHINA</span><span class="pl-k">.</span>toString());
messageEntity<span class="pl-k">.</span>setContent(<span class="pl-s"><span class="pl-pds">"</span>你好<span class="pl-pds">"</span></span>);
messageEntity<span class="pl-k">.</span>setId(<span class="pl-s"><span class="pl-pds">"</span>3000<span class="pl-pds">"</span></span>);
session<span class="pl-k">.</span>save(messageEntity);

<span class="pl-c">//int openthinks.libs.sql.dhibernate.Session.add(String sql, String[] params)</span>
<span class="pl-c">// Low level</span>
<span class="pl-smi">String</span> saveSQL <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>INSERT INTO message(message_id,message_locale,message_content) values(?,?,?)<span class="pl-pds">"</span></span>;
<span class="pl-k">String</span>[] params <span class="pl-k">=</span> {<span class="pl-s"><span class="pl-pds">"</span>4000<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>en_US<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>Hello again<span class="pl-pds">"</span></span>};
<span class="pl-k">int</span> affectRow <span class="pl-k">=</span> session<span class="pl-k">.</span>add(saveSQL,params);
session<span class="pl-k">.</span>close();</pre></div>

			<div class="highlight highlight-java"><pre><span class="pl-c">//&lt;T&gt; void openthinks.libs.sql.dhibernate.Session.update(T object)</span>
<span class="pl-smi">Session</span> session <span class="pl-k">=</span> <span class="pl-smi">SessionFactory</span><span class="pl-k">.</span>getSession();
<span class="pl-smi">MessageJPA</span> message <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">MessageJPA</span>();
message<span class="pl-k">.</span>setLocale(<span class="pl-smi">Locale</span><span class="pl-c1"><span class="pl-k">.</span>CHINA</span><span class="pl-k">.</span>toString());
message<span class="pl-k">.</span>setContent(<span class="pl-s"><span class="pl-pds">"</span>中国你好<span class="pl-pds">"</span></span>);
message<span class="pl-k">.</span>setMessageId(<span class="pl-s"><span class="pl-pds">"</span>2000<span class="pl-pds">"</span></span>);
session<span class="pl-k">.</span>update(message);

<span class="pl-c">//int openthinks.libs.sql.dhibernate.Session.update(String sql, String[] params)</span>
<span class="pl-smi">String</span> updateSQL <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>update message set message_content = ? where message_id =? and message_locale=?<span class="pl-pds">"</span></span>;
<span class="pl-k">String</span>[] params <span class="pl-k">=</span> {<span class="pl-s"><span class="pl-pds">"</span>您好<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>zh_CN<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>2000<span class="pl-pds">"</span></span>};
session<span class="pl-k">.</span>update();
session<span class="pl-k">.</span>close();</pre></div>

			<div class="highlight highlight-java"><pre><span class="pl-c">//&lt;T&gt; void openthinks.libs.sql.dhibernate.Session.delete(T object)</span>
<span class="pl-smi">MessageJPA</span> messageJPA <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">MessageJPA</span>();
messageJPA<span class="pl-k">.</span>setLocale(<span class="pl-smi">Locale</span><span class="pl-c1"><span class="pl-k">.</span>US</span><span class="pl-k">.</span>toString());
messageJPA<span class="pl-k">.</span>setContent(<span class="pl-s"><span class="pl-pds">"</span>HELLO<span class="pl-pds">"</span></span>);
messageJPA<span class="pl-k">.</span>setMessageId(<span class="pl-s"><span class="pl-pds">"</span>2000<span class="pl-pds">"</span></span>);
<span class="pl-smi">Session</span> session <span class="pl-k">=</span> <span class="pl-smi">SessionFactory</span><span class="pl-k">.</span>getSession();
session<span class="pl-k">.</span>delete(messageJPA);

<span class="pl-c">//int openthinks.libs.sql.dhibernate.Session.delete(String sql, String[] params)</span>
<span class="pl-smi">String</span> deleteSQL <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>delete message where message_id =? and message_locale=?<span class="pl-pds">"</span></span>;
<span class="pl-k">String</span>[] params <span class="pl-k">=</span> {<span class="pl-s"><span class="pl-pds">"</span>zh_CN<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>2000<span class="pl-pds">"</span></span>};
session<span class="pl-k">.</span>delete(deleteSQL,params);
session<span class="pl-k">.</span>close();</pre></div>

			<h5>
<a id="条件查询" class="anchor" href="#%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>条件查询</strong>
</h5>

			<p>对于简单根据单一主键获取记录或获取所有表中记录,推荐使用High level API:</p>

			<pre><code>// 根据id值获取clz类型的实体对象
&lt;T&gt; T openthinks.libs.sql.dhibernate.Session.load(Class&lt;T&gt; clz, Serializable id)
// 获取所有相应实体类的集合列表
&lt;T&gt; List&lt;T&gt; openthinks.libs.sql.dhibernate.Session.list(Class&lt;T&gt; clz)
</code></pre>

			<p>而对于一些复杂的查询，可以使用接下来的方式</p>

			<h6>
<a id="直接sql语句查询" class="anchor" href="#%E7%9B%B4%E6%8E%A5sql%E8%AF%AD%E5%8F%A5%E6%9F%A5%E8%AF%A2" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>直接SQL语句查询</strong>
</h6>

			<div class="highlight highlight-java"><pre><span class="pl-smi">Session</span> session <span class="pl-k">=</span> <span class="pl-smi">SessionFactory</span><span class="pl-k">.</span>getSession();
<span class="pl-smi">String</span> querySQL <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>SELECT * FROM message WHERE message_id = ? and message_locale= ? <span class="pl-pds">"</span></span>;
<span class="pl-smi">MessgaeJPA</span> messageJPA <span class="pl-k">=</span> session<span class="pl-k">.</span>get(<span class="pl-smi">MessageJPA</span><span class="pl-k">.</span>class, querySQL,<span class="pl-k">new</span> <span class="pl-smi">String</span>[]{<span class="pl-s"><span class="pl-pds">"</span>2000<span class="pl-pds">"</span></span>,<span class="pl-s"><span class="pl-pds">"</span>zh_CN<span class="pl-pds">"</span></span>});
<span class="pl-c">//Messgae message = session.get(Message.class, querySQL,new String[]{"2000","zh_CN"});</span>
<span class="pl-k">List&lt;<span class="pl-smi">MessageJPA</span>&gt;</span> list <span class="pl-k">=</span> session<span class="pl-k">.</span>list(<span class="pl-smi">MessageJPA</span><span class="pl-k">.</span>class, <span class="pl-s"><span class="pl-pds">"</span>SELECT * FROM message<span class="pl-pds">"</span></span>,<span class="pl-k">new</span> <span class="pl-smi">String</span>[]{});
<span class="pl-c">//List&lt;Message&gt; list = session.list(Message.class, "SELECT * FROM message",new String[]{});</span>
<span class="pl-c">// 不指定实体类型时,将使用 openthinks.libs.sql.data.Row</span>
<span class="pl-k">List&lt;<span class="pl-smi">Row</span>&gt;</span> rows <span class="pl-k">=</span> session<span class="pl-k">.</span>list(<span class="pl-s"><span class="pl-pds">"</span>SELECT * FROM message<span class="pl-pds">"</span></span>,<span class="pl-k">new</span> <span class="pl-smi">String</span>[]{});
session<span class="pl-k">.</span>close();</pre></div>

			<h6>
<a id="简单条件类查询" class="anchor" href="#%E7%AE%80%E5%8D%95%E6%9D%A1%E4%BB%B6%E7%B1%BB%E6%9F%A5%E8%AF%A2" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>简单条件类查询</strong>
</h6>

			<p>简单条件类: openthinks.libs.sql.lang.Condition是非常底层的,也属于Low level.
				<a href="doc/openthinks/libs/sql/lang/Condition.html">Condition</a>对象可以如下创建:</p>

			<pre><code>Session session = SessionFactory.getSession();
session.createCondition(); // same as Condition.build()
</code></pre>

			<pre><code>// where 1=1
Condition condition1 = Condition.build(); 
// SELECT * FROM message where 1=1
Condition condition2 = Condition.build("SELECT * FROM message");
// SELECT * FROM message where 1=1
Condition condition3 = Condition.build(MessageJPA.class);
</code></pre>

			<p>如何使用:(暂支持 绝对匹配 <em>=</em>,模糊匹配 <em>like</em>,开始于 <em>&gt;</em>,结束于 <em>&lt;</em>) 参考以下 test case:</p>

			<div class="highlight highlight-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">ConditionTest</span> {
    <span class="pl-k">private</span> <span class="pl-k">static</span> <span class="pl-smi">MessageJPA</span> message <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">MessageJPA</span>();
    <span class="pl-k">private</span> <span class="pl-k">static</span> <span class="pl-smi">MessageJPA</span> message2 <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">MessageJPA</span>();
    <span class="pl-k">@BeforeClass</span>
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">setUp</span>() {
        <span class="pl-smi">Session</span> session <span class="pl-k">=</span> <span class="pl-smi">SessionFactory</span><span class="pl-k">.</span>getSession();
        message<span class="pl-k">.</span>setMessageId(<span class="pl-s"><span class="pl-pds">"</span>CONDITION_1<span class="pl-pds">"</span></span>);
        message<span class="pl-k">.</span>setLocale(<span class="pl-smi">Locale</span><span class="pl-c1"><span class="pl-k">.</span>US</span><span class="pl-k">.</span>toString());
        message<span class="pl-k">.</span>setContent(<span class="pl-s"><span class="pl-pds">"</span>Condition class regular test<span class="pl-pds">"</span></span>);
        session<span class="pl-k">.</span>save(message);

        message2<span class="pl-k">.</span>setMessageId(<span class="pl-s"><span class="pl-pds">"</span>CONDITION_2<span class="pl-pds">"</span></span>);
        message2<span class="pl-k">.</span>setLocale(<span class="pl-smi">Locale</span><span class="pl-c1"><span class="pl-k">.</span>US</span><span class="pl-k">.</span>toString());
        message2<span class="pl-k">.</span>setContent(<span class="pl-s"><span class="pl-pds">"</span>Condition class other test<span class="pl-pds">"</span></span>);
        session<span class="pl-k">.</span>save(message2);
        session<span class="pl-k">.</span>close();
    }
    <span class="pl-k">@Test</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">regularTest</span>() {
        <span class="pl-smi">Session</span> session <span class="pl-k">=</span> <span class="pl-smi">SessionFactory</span><span class="pl-k">.</span>getSession();
        <span class="pl-smi">Condition</span> condition <span class="pl-k">=</span> session<span class="pl-k">.</span>createCondition();
        condition<span class="pl-k">.</span>setSqlPart(<span class="pl-s"><span class="pl-pds">"</span>SELECT * FROM message<span class="pl-pds">"</span></span>);
        <span class="pl-c">// 等效于 Condition.build("SELECT * FROM message");</span>

        <span class="pl-c">//第一个参数为条件类型;第二个参数为表字段;第三参数为对应的条件值</span>
        condition<span class="pl-k">.</span>addItem(<span class="pl-smi">Condition</span><span class="pl-c1"><span class="pl-k">.</span>ABSMATCH</span>, <span class="pl-s"><span class="pl-pds">"</span>message_id<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>CONDITION_1<span class="pl-pds">"</span></span>);
        <span class="pl-smi">MessageJPA</span> msg <span class="pl-k">=</span> session<span class="pl-k">.</span>get(<span class="pl-smi">MessageJPA</span><span class="pl-k">.</span>class, condition);
        <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertNotNull(msg);
        <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertEquals(message<span class="pl-k">.</span>getContent(), msg<span class="pl-k">.</span>getContent());
        session<span class="pl-k">.</span>close();
    }
    <span class="pl-k">@Test</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">otherTest</span>() {
        <span class="pl-smi">Condition</span> condition <span class="pl-k">=</span> <span class="pl-smi">Condition</span><span class="pl-k">.</span>build(<span class="pl-smi">MessageJPA</span><span class="pl-k">.</span>class)
                .addItem(<span class="pl-smi">Condition</span><span class="pl-c1"><span class="pl-k">.</span>LIKEMATCH</span>, <span class="pl-s"><span class="pl-pds">"</span>message_id<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>CONDITION%<span class="pl-pds">"</span></span>)
                .addItem(<span class="pl-smi">Condition</span><span class="pl-c1"><span class="pl-k">.</span>ORDER</span>, <span class="pl-s"><span class="pl-pds">"</span>message_id<span class="pl-pds">"</span></span>, <span class="pl-smi">Condition</span><span class="pl-k">.</span><span class="pl-smi">Order</span><span class="pl-c1"><span class="pl-k">.</span>DESC</span>);<span class="pl-c">//排序</span>
        <span class="pl-smi">Session</span> session <span class="pl-k">=</span> <span class="pl-smi">SessionFactory</span><span class="pl-k">.</span>getSession();
        <span class="pl-k">List&lt;<span class="pl-smi">MessageJPA</span>&gt;</span> list <span class="pl-k">=</span> session<span class="pl-k">.</span>list(<span class="pl-smi">MessageJPA</span><span class="pl-k">.</span>class, condition);
        <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertTrue(list<span class="pl-k">.</span>size() <span class="pl-k">==</span> <span class="pl-c1">2</span>);
        <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertEquals(message2<span class="pl-k">.</span>getMessageId(), list<span class="pl-k">.</span>get(<span class="pl-c1">0</span>)<span class="pl-k">.</span>getMessageId());
        session<span class="pl-k">.</span>close();
    }
    <span class="pl-k">@AfterClass</span>
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">tearDown</span>() {
        <span class="pl-smi">Session</span> session <span class="pl-k">=</span> <span class="pl-smi">SessionFactory</span><span class="pl-k">.</span>getSession();
        session<span class="pl-k">.</span>delete(message);
        session<span class="pl-k">.</span>delete(message2);
        session<span class="pl-k">.</span>close();
    }
}</pre></div>

			<h6>
<a id="智能queryfilter查询" class="anchor" href="#%E6%99%BA%E8%83%BDqueryfilter%E6%9F%A5%E8%AF%A2" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>智能QueryFilter查询</strong>
</h6>

			<p>目前实现的filter有 </p>

			<blockquote>
				<p>Filters.eq, Filters.neq Filters.include, Filters.startWith, Filters.endWith Filters.and, Filters.or, Filters.group</p>
			</blockquote>

			<div class="highlight highlight-java"><pre><span class="pl-smi">Session</span> session <span class="pl-k">=</span>  <span class="pl-smi">SessionFactory</span><span class="pl-k">.</span>getSession();
<span class="pl-c">// 获取Query对象</span>
<span class="pl-k">Query&lt;<span class="pl-smi">MessageJPA</span>&gt;</span> query <span class="pl-k">=</span> session<span class="pl-k">.</span>createQuery(<span class="pl-smi">MessageJPA</span><span class="pl-k">.</span>class);
<span class="pl-c">// 定义具体的QueryFilter</span>
<span class="pl-smi">QueryFilterGroup</span> group <span class="pl-k">=</span> <span class="pl-smi">Filters</span><span class="pl-k">.</span>group();
group<span class="pl-k">.</span>push(<span class="pl-smi">Filters</span><span class="pl-k">.</span>eq(<span class="pl-s"><span class="pl-pds">"</span>messageId<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>4000<span class="pl-pds">"</span></span>));
group<span class="pl-k">.</span>push(<span class="pl-smi">Filters</span><span class="pl-k">.</span>or());
<span class="pl-smi">QueryFilterGroup</span> embedGrp <span class="pl-k">=</span> <span class="pl-smi">Filters</span><span class="pl-k">.</span>group();
embedGrp<span class="pl-k">.</span>push(<span class="pl-smi">Filters</span><span class="pl-k">.</span>eq(<span class="pl-s"><span class="pl-pds">"</span>messageId<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>2000<span class="pl-pds">"</span></span>));
embedGrp<span class="pl-k">.</span>push(<span class="pl-smi">Filters</span><span class="pl-k">.</span>eq(<span class="pl-s"><span class="pl-pds">"</span>locale<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>zh_CN<span class="pl-pds">"</span></span>));
group<span class="pl-k">.</span>push(embedGrp);
<span class="pl-c">// 最终SQL(MYSQL):</span>
<span class="pl-c">// select * from `message` where  ( `message_id` = '4000'  or  ( `message_id` = '2000'  and message_locale = 'zh_CN')  ) </span>
<span class="pl-c">// 添加到Query对象</span>
query<span class="pl-k">.</span>addFilter(group);
<span class="pl-k">List&lt;<span class="pl-smi">MessageJPA</span>&gt;</span> list <span class="pl-k">=</span> query<span class="pl-k">.</span>execute();
session<span class="pl-k">.</span>close();</pre></div>

			<h5>
<a id="简单事务" class="anchor" href="#%E7%AE%80%E5%8D%95%E4%BA%8B%E5%8A%A1" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>简单事务</strong>
</h5>

			<ul>
				<li>开启事务 <code>session.beginTransaction();</code> 另外
					<code>session.beginTransaction(TransactionLevel.TRANSACTION_READ_UNCOMMITTED)</code> 设置事务级别
				</li>
				<li>关闭事务 <code>session.endTransaction();</code> 另外 <code>session.close();</code> 也会默认关闭事务,如果开启的话.
				</li>
			</ul>

			<p>例子:</p>

			<div class="highlight highlight-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">TransactionTest</span> {
    <span class="pl-k">private</span> <span class="pl-k">static</span> <span class="pl-smi">MessageJPA</span> message <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">MessageJPA</span>();
    <span class="pl-k">@BeforeClass</span>
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">setUp</span>() {
        <span class="pl-smi">Session</span> session <span class="pl-k">=</span> <span class="pl-smi">SessionFactory</span><span class="pl-k">.</span>getSession();
        message<span class="pl-k">.</span>setMessageId(<span class="pl-s"><span class="pl-pds">"</span>TRANSACTION<span class="pl-pds">"</span></span>);
        message<span class="pl-k">.</span>setLocale(<span class="pl-smi">Locale</span><span class="pl-c1"><span class="pl-k">.</span>US</span><span class="pl-k">.</span>toString());
        message<span class="pl-k">.</span>setContent(<span class="pl-s"><span class="pl-pds">"</span>Transaction test<span class="pl-pds">"</span></span>);
        session<span class="pl-k">.</span>save(message);
        session<span class="pl-k">.</span>close();
    }
    <span class="pl-k">@Test</span>
    <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">beginTransactionTest</span>() <span class="pl-k">throws</span> <span class="pl-smi">TransactionException</span> {
        <span class="pl-smi">Session</span> session <span class="pl-k">=</span> <span class="pl-smi">SessionFactory</span><span class="pl-k">.</span>getSession();
        session<span class="pl-k">.</span>beginTransaction();
        message<span class="pl-k">.</span>setContent(<span class="pl-s"><span class="pl-pds">"</span>Transaction test rollback<span class="pl-pds">"</span></span>);
        session<span class="pl-k">.</span>update(message);
        <span class="pl-k">int</span> result <span class="pl-k">=</span> session<span class="pl-k">.</span>add(<span class="pl-s"><span class="pl-pds">"</span>insert into message<span class="pl-pds">"</span></span>);<span class="pl-c">//错误语法,新增不成功</span>
        <span class="pl-k">if</span> (result <span class="pl-k">==</span> <span class="pl-c1">0</span>) {
            session<span class="pl-k">.</span>rollback();
        } <span class="pl-k">else</span> {
            session<span class="pl-k">.</span>commit();
        }
        session<span class="pl-k">.</span>endTransaction();

        <span class="pl-smi">MessageJPA</span> msg <span class="pl-k">=</span> session<span class="pl-k">.</span>load(<span class="pl-smi">MessageJPA</span><span class="pl-k">.</span>class, message<span class="pl-k">.</span>getMessageId());
        <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertNotNull(msg);
        <span class="pl-smi">Assert</span><span class="pl-k">.</span>assertEquals(<span class="pl-s"><span class="pl-pds">"</span>Transaction test<span class="pl-pds">"</span></span>, msg<span class="pl-k">.</span>getContent());
        session<span class="pl-k">.</span>close();
    }
    <span class="pl-k">@AfterClass</span>
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">tearDown</span>() {
        <span class="pl-smi">Session</span> session <span class="pl-k">=</span> <span class="pl-smi">SessionFactory</span><span class="pl-k">.</span>getSession();
        session<span class="pl-k">.</span>delete(message);
        session<span class="pl-k">.</span>close();
    }
}</pre></div>

			<h5>
<a id="连接池" class="anchor" href="#%E8%BF%9E%E6%8E%A5%E6%B1%A0" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>连接池</strong>
</h5>

			<p>目前支持简单的连接池实现 <code>openthinks.libs.sql.dao.pool.impl.SimpleConnectionPool</code>; 可以自行扩展 <code>openthinks.libs.sql.dao.pool.ConnectionPool</code>接口,并替换默认的实现:</p>

			<div class="highlight highlight-java"><pre><span class="pl-smi">MyConnectionPool</span> connPool <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">MyConnectionPool</span>();<span class="pl-c">// your implemented ConnectionPool</span>
<span class="pl-smi">ConnectionPoolManager</span><span class="pl-k">.</span>setSingletonPoolInstance(connPool);<span class="pl-c">// make it replace the default pool</span></pre></div>

			<p>当然使用连接池前,必须配置,在配置文件 dbconfig.properties 中, 加入:</p>

			<pre><code>USEPOOL=true
#可选,不配的话默认无限制
MAX_ACTIVE=100
#可选,不配的话默认无限制
MAX_IDLE=10
</code></pre>

			<p>对于扩展的<a href="doc/openthinks/libs/sql/dao/pool/ConnectionPool.html">ConnectionPool</a>, 除了如上所述使用Code替换默认实现, 亦可以在配置文件中指明实现类名称</p>

			<pre><code>USEPOOL=true
POOL_CLASS=openthinks.libs.sql.MyConnectionPool
</code></pre>

			<p>需要注意事项是构造函数的定义:</p>

			<ol>
				<li>MyConnectionPool(Configuration) 和 MyConnectionPool() 至少需要定义一个</li>
				<li>MyConnectionPool() 需要自行获取配置类,以确保获取到数据库连接</li>
				<li>优先使用 MyConnectionPool(Configuration) 构造函数</li>
			</ol>

			<p>
				<h4><a id="JavaDoc" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Java Doc</strong></h4> Click <a href="doc/index.html">here</a>
			</p>
			<footer class="site-footer">
				<span class="site-footer-owner"><a href="https://github.com/daileyet/openlibs.sql">Openlibs.sql</a> is maintained by <a href="https://github.com/daileyet">daileyet</a>.</span>

				<span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
			</footer>

		</section>

	</body>

</html>